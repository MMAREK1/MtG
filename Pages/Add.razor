@page "/Add"

@using Blazor.Data
@using System.IO;
@using System.Collections.Generic;
@inject AddService PridatService
@inject IJSRuntime jsRuntime

<h1>Pridat Karty</h1>

<br>
<div class="container">
  <div class="row">
    <div class="col-xs-6 col-sm-3 col-md-3">
<table>
<textarea 
  class="form-control" maxlength="255" style="width:600px;"
  @bind="zoznam" id="Comments" required>
</textarea>
</table>
</div>
</div>
</div>

<br>
<center>
    Format : Kaya's Onslaught;KHM;1;;18:Spectral Steel;KHM;1;;30 - <br />"Nazov Kary";"Kod set";"pocet";"F(ak je karta foil inak prazdne)";"cislokarty":"Nazov Kary";"Kod set";"pocet";"F(ak je karta foil inak prazdne)";"cislokarty"
    <br />
<select name="Zdroj" @bind="@subor">
    @foreach(var file in files)
    {
        <option value = "@file"> @file.Substring(file.IndexOf('\\')+1) </option >
    }
</select>
<button @onclick="AddCards" style="display: inline-block;">Add</button>
<br>
</center>
<br>

@if (koniec != null)
{
    <p><em>Skoncilo</em></p>
}


@code {	
	private string koniec;
	private string zoznam;
	private List<string> files=new List<string>();
	private string subor;
	private string[] fileEntries;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await jsRuntime.InvokeAsync<bool>("ResizeTextArea", "Comments");
    }

    
    protected override async Task OnInitializedAsync()
    {
		fileEntries = Directory.GetFiles(@"json\");
		files = fileEntries.ToList();
        subor=fileEntries[0];
    }
	
	private async Task AddCards()
    {
        koniec = await PridatService.AddCards(subor, zoznam);
        zoznam=null;
    }
}
